# ğŸ”„ Model Comparison Feature

This feature enables side-by-side visualization and comparison of two 3D models generated by Glimpse3D.

## ğŸ“‹ Overview

The comparison feature allows users to:
- **View two 3D models simultaneously** in split-screen mode
- **Compare quality metrics** (splat count, processing time, quality scores)
- **Select any completed projects** from the database
- **Toggle camera synchronization** for aligned viewing
- **Export comparison reports** (planned feature)

## ğŸ—ï¸ Architecture

### **Backend Components**

#### 1. **API Endpoints** (`backend/app/routes/compare.py`)

```python
GET /api/v1/compare/projects
# Returns list of all completed projects with metadata

GET /api/v1/compare/{project_id_1}/{project_id_2}
# Fetches full data for two projects to enable comparison

GET /api/v1/compare/project/{project_id}/models
# Gets all model versions for a project
```

#### 2. **Database Helpers** (`backend/app/core/database.py`)

```python
DatabaseManager.get_projects_for_comparison(limit=50, status="completed")
# Queries projects suitable for comparison

DatabaseManager.get_project_comparison_data(project_id)
# Gets comprehensive data for a single project
```

**Data Structure Returned:**
```python
{
    "id": "uuid",
    "status": "completed",
    "model": {
        "url": "https://...",
        "num_splats": 12000,
        "file_size_mb": 2.5
    },
    "metrics": {
        "overall_quality": 0.85,
        "psnr": 28.5,
        "ssim": 0.92
    },
    "pipeline_progress": {
        "multiview_count": 16,
        "depth_count": 16,
        "iterations_count": 3
    }
}
```

### **Frontend Components**

#### 1. **CompareView Page** (`frontend/src/pages/CompareView.tsx`)

The main comparison interface with:
- Top navigation bar with controls
- Dual canvas split-screen layout
- Floating metrics overlay
- Project selection buttons

**URL Parameters:**
- `/compare?projectA=<uuid>&projectB=<uuid>`
- Enables direct linking to specific comparisons

#### 2. **DualThreeCanvas Component** (`frontend/src/components/DualThreeCanvas.tsx`)

Renders two separate Three.js scenes side-by-side:
- Independent orbit controls per canvas
- Color-coded labels (Gold for A, Cyan for B)
- Glassmorphism center divider
- Optional camera synchronization

**Props:**
```typescript
interface DualThreeCanvasProps {
    leftModelUrl: string | null;
    rightModelUrl: string | null;
    syncCameras?: boolean;
    leftTitle?: string;
    rightTitle?: string;
}
```

#### 3. **ProjectSelector Component** (`frontend/src/components/ProjectSelector.tsx`)

Modal dialog for selecting projects:
- Grid layout with thumbnails
- Displays metadata (date, processing time)
- Shows quality metrics as badges
- Visual selection indicator

**Props:**
```typescript
interface ProjectSelectorProps {
    isOpen: boolean;
    onClose: () => void;
    onSelect: (project: Project) => void;
    selectedProjectId?: string | null;
    title?: string;
}
```

## ğŸ¨ Design System Integration

All components follow Glimpse3D's design system:
- **Colors**: Carbon Black, Graphite Gray, Soft Gold, Ultramarine Cyan
- **Typography**: Space Grotesk (headings), Manrope (body)
- **Effects**: Glassmorphism, backdrop blur, gradient dividers
- **Animations**: Framer Motion with spring physics

## ğŸš€ Usage

### **From Workspace**

1. Navigate to the **Export** tab in the right panel
2. Click **"Compare Models"** button
3. Select two projects from the modal
4. View side-by-side comparison

### **Direct URL**

```
http://localhost:5173/compare?projectA=<uuid1>&projectB=<uuid2>
```

### **API Integration**

```typescript
// Fetch available projects
const response = await fetch('http://localhost:8000/api/v1/compare/projects');
const { projects } = await response.json();

// Fetch comparison data
const comparison = await fetch(
  `http://localhost:8000/api/v1/compare/${projectA}/${projectB}`
);
const { project_a, project_b } = await comparison.json();
```

## ğŸ§ª Testing

Run the integration test:

```bash
cd backend
python test_compare_feature.py
```

This tests:
- âœ… Backend server health
- âœ… Database helper functions
- âœ… Compare API endpoints
- âœ… Data retrieval for multiple projects

## ğŸ“Š Features Roadmap

### **âœ… Implemented**
- [x] Side-by-side 3D visualization
- [x] Project selection modal
- [x] Quality metrics display
- [x] URL-based navigation
- [x] Backend API endpoints
- [x] Database queries

### **ğŸš§ Planned**
- [ ] Actual .ply/.glb model loading (currently placeholder geometry)
- [ ] Camera synchronization implementation
- [ ] Export comparison reports (PDF/CSV)
- [ ] Diff visualization (highlight differences)
- [ ] Multi-model comparison (3+ models)
- [ ] Performance benchmarking charts

## ğŸ”§ Configuration

### **Backend**

No additional configuration needed. The feature uses existing Supabase connection.

### **Frontend**

Default API URL: `http://localhost:8000/api/v1/compare`

To change, update in:
- `CompareView.tsx`
- `ProjectSelector.tsx`

Or use environment variables:
```typescript
const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000';
```

## ğŸ› Troubleshooting

### **"No projects found"**

- Ensure you have created at least one project with status='completed'
- Check Supabase connection in backend
- Verify `projects` table has data

### **Models not loading**

- Check `model_file_url` is accessible (Supabase storage policies)
- Verify bucket permissions allow public read
- Ensure .ply/.glb files are valid

### **API errors**

- Confirm backend is running: `uvicorn app.main:app --reload`
- Check CORS settings in `backend/app/main.py`
- Verify Supabase credentials in `.env`

## ğŸ“š Related Documentation

- [Backend README](../backend/README.md)
- [Frontend README](../frontend/README.md)
- [Supabase Setup Guide](../backend/SUPABASE_SETUP.md)
- [Pipeline Diagram](../backend/PIPELINE_DIAGRAM.md)

---

**Built with ğŸ’› for Glimpse3D**
